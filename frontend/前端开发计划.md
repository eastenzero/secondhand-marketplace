# 前端开发计划（MVP）

## 1 范围与目标
- 覆盖：注册/登录、商品与需求的列表/筛选与详情、发布（商品/需求）、发起报价、留言互动、我的信息管理（更新/下架/删除）、可选审核页。
- 对齐：与 backend/api-spec.md 一致；严格遵循错误码与鉴权策略；接口超时/重试与全局错误提示一致化。
- 非功能：
  - 性能：核心页面 P95 ≤ 2s；首屏 ≤ 2s；可感知加载（Skeleton）。
  - 可用性：清晰表单校验与错误提示；A11y 基线（语义化/焦点管理/键盘可达）。
  - 可维护：模块化、契约先行（基于 api-spec.md 的类型推导/Mock）。

## 2 技术栈与约定（建议，未束缚实现）
- 框架：React + TypeScript + Vite（或 Next.js/CSR 优先；若 Vue 技术栈，则 Vue3 + Vite + Vue Router）。
- 路由：React Router v6；受保护路由（鉴权守卫）。
- 状态：Zustand/Redux Toolkit（二选一）；请求：Axios；表单：React Hook Form + Zod（或 Yup）。
- UI：TailwindCSS + 组件库（如 shadcn/ui 或 Ant Design）；图标：Lucide。
- 代码质量：ESLint + Prettier；Husky + lint-staged；Commit 规范。
- i18n：可选；先中文。
- 目录建议：
  - src/pages（路由页面）/ components（通用组件）/ features（领域组件）/ services（API 客户端）/ stores（全局状态）/ hooks / utils / assets。

## 3 路由与页面
- 路由图：assets/derived/router.mmd（PNG 同名）。
- 页面与接口映射（节选）：

| 路由 | 页面 | 鉴权 | 主要接口 | 备注 |
| --- | --- | --- | --- | --- |
| /login | 登录 | 游客 | POST /api/login | 设置 HttpOnly Cookie，跳转回来源页 |
| /register | 注册 | 游客 | POST /api/register | 表单校验与重复名提示 |
| /items | 商品列表 | 游客 | GET /api/items | 关键词/分类/价格；分页 |
| /items/:id | 商品详情 | 游客 | GET /api/items/{id} | 聚合 offers/comments |
| /publish/item | 发布商品 | 会员 | POST /api/items | 成功跳详情；pending 或 active |
| /demands | 需求列表 | 游客 | GET /api/demands | 同商品列表 |
| /demands/:id | 需求详情 | 游客 | GET /api/demands/{id} | 聚合 offers/comments |
| /publish/demand | 发布需求 | 会员 | POST /api/demands | |
| /offer | 发起报价 | 会员 | POST /api/offers | 详情页内弹窗/侧滑 |
| /comment | 留言提交 | 会员 | POST /api/comments | 详情页内提交后刷新列表 |
| /me/posts | 我的发布 | 会员 | PATCH /api/items/{id} | 更新/下架/删除（软删） |
| /admin/review | 审核台（可选） | 管理员 | - | review.enabled=true 时开放 |

## 4 组件设计（示例）
- 通用：NavBar、Footer、SearchBar、Filters、ItemCard、DemandCard、PriceInput、Uploader、Pagination、Skeleton、Toast。
- 页面内：ItemDetailPanel、OfferDialog、CommentList、PublishFormItem/PublishFormDemand、MyPostTable。
- 无障碍与状态：FocusableModal、VisuallyHidden、LiveRegion（错误/成功提示）。

## 5 状态管理
- 全局：auth（token/session）、me（用户信息）、ui（toasts/modals/spinner）。
- 资源缓存：items.list、items.detail[id]、demands.list、demands.detail[id]、offers.byTarget、comments.byTarget。
- 失效策略：发布/报价/留言/下架成功后，失效对应列表与详情缓存；分页与筛选入 key。

## 6 表单与校验
- 注册/登录：用户名 3-50；密码≥6；contact.email 格式校验。
- 发布：title 必填≤100；price/expected_price>0；images 数量与类型限制；desc 文本长度上限（如 2000）。
- 报价：amount>0；禁止自报价（由后端兜底，前端提示）。
- 留言：content 非空与敏感词基础校验（前端提示）。

## 7 鉴权与守卫
- Cookie：读取登录态（服务端 Set-Cookie）；未登录访问受保护页→重定向 /login 并带回跳。
- 接口 401 统一拦截→弹窗提示→跳转登录；403 提示权限不足。

## 8 错误、日志与可观测
- 全局错误边界（兜底页面）；Axios 拦截器（错误码→文案映射）。
- 操作结果统一 Toast；关键交互埋点（可选，控制台或简单 logger）。

## 9 性能与可访问性
- 代码分割与懒加载；图像懒加载；分页/虚拟列表（如需）。
- Skeleton/占位；禁止布局抖动；语义化标签；表单控件/label/aria-* 完整。

## 10 测试
- 单元：组件/hooks；Mock（msw）。
- 集成：页面级交互（Router + 状态 + msw）。
- 端到端：Playwright/Cypress（登录、发布、报价、留言、下架）。

## 11 构建与部署
- 环境：.env（VITE_API_BASE 等）；CI 构建与预览；Nginx 静态托管与反向代理 /api。
- 缓存：静态资产长缓存；HTML 不缓存；API 透传。

## 12 DoR/DoD（前端）
- DoR：接口契约明确、UI 草图/交互说明具备、验收标准明确、Mock 数据就绪。
- DoD：代码合并、单/集成/E2E 通过、可访问性清单通过、文档更新、演示通过。

## 13 需求清单与顺序（前端 Backlog）

| ID | 工作项 | 类型 | 依赖 | 验收 |
| --- | --- | --- | --- | --- |
| F0 | 项目骨架/路由/样式/质量工具 | Tech | - | 可启动/健康检查页/规范通过 |
| F1 | 认证（登录/注册） | Feat | F0, B2 | 登录态持久；401 处理 |
| F2 | 商品列表/详情 | Feat | F0, B3/B4 | 列表/详情联通；加载态 |
| F3 | 发布商品 | Feat | F1, B3 | 成功跳转详情；表单校验 |
| F4 | 搜索/筛选/分页 | Feat | F2 | 筛选项联动；分页稳定 |
| F5 | 需求列表/详情/发布 | Feat | F1, B5 | 对称功能可用 |
| F6 | 发起报价 | Feat | F1, B6 | 自报价拦截提示；成功反馈 |
| F7 | 留言 | Feat | F1, B7 | 新增后刷新列表 |
| F8 | 我的管理（更新/下架/删除） | Feat | F1, B8 | 状态变化可见 |
| F9 | 审核台（可选） | Feat | F1, B11? | pending→active 流程 |
| F10 | 错误码与日志统一 | Tech | F1 | 错误文案表；拦截器生效 |
| F11 | 性能与A11y硬化 | Tech | F2-F8 | P95≤2s；A11y清单通过 |

## 14 风险与缓解
- 接口变更：OpenAPI/契约先行；Mock 同步；回归测试。
- 登录态问题：Cookie 同站策略、跨域代理；本地/生产一致性演练。
- 列表性能：分页上限与虚拟滚动；索引与后端分页对齐。
